---

# PyLean デモシステム仕様書 (Draft)

## 1. コンセプト

Pythonの「読みやすさ」をフロントエンドに、Lean 4の「数学的厳密性」をバックエンドに配置した、双方向表示エディタ。
ユーザーがPythonを書くと、裏側でAST（抽象構文木）が生成され、それがリアルタイムでLean 4のコードとして「翻訳」・「検証」される。

## 2. 画面構成 (UI Mockup)

2ペインのWebエディタ構成とする。

| 左ペイン：Python View (Editor) | 右ペイン：Lean 4 View (Viewer) |
| --- | --- |
| ユーザーが限定的なPythonを入力。 | 変換されたLean 4コードを表示（編集不可）。 |
| シンタックスハイライト、エラー下線。 | 下部に「検証ステータス」を表示。 |

---

## 3. 変換対象（第一期スコープ：四則演算と関数）

最初は「複雑なことはしない」というルールを徹底し、以下の要素のみを変換対象とする。

### 対応表 (Mapping Table)

| Python 要素 (`ast`ノード) | Lean 4 要素 | 備考 |
| --- | --- | --- |
| `FunctionDef` | `def` | 型ヒントを必須とする。 |
| `Return` | (関数の戻り値) |  |
| `BinOp(Add)` | `+` (HAdd) |  |
| `BinOp(Sub)` | `-` (HSub) |  |
| `BinOp(Mult)` | `*` (HMul) |  |
| `BinOp(Div)` | `/` (HDiv) | ゼロ除算の検証対象。 |
| `Constant` | `Literal` | 数値データのみ。 |

---

## 4. デモの動作フロー

1. **解析:** `ast.parse()` を用いて、PythonコードをASTに変換する。
2. **検証（簡易）:** ASTをスキャンし、許可されていない構文（`import`, `class`, `print`等）があれば左ペインに警告を出す。
3. **生成:**
* **Lean View:** ASTの各ノードを再帰的にたどり、Lean 4の文法に文字列結合で出力する。
* **Python View:** 同様に、正規化されたPythonコードを出力（保存形式がASTであることの証明）。


4. **Lean Kernel 連携:** * 生成されたLeanコードをバックエンドのLean 4コンパイラに送信。
* エラー（型不一致、証明失敗）があれば、右ペイン下部にメッセージを表示。



---

## 5. 象徴的なデモケース

このシステムの凄さを伝えるための「キラーコンテンツ」としてのコード例。

**【入力するPython】**

```python
def safe_add(n: int) -> int:
    return n + 10

```

**【自動生成されるLean 4】**

```lean
def safe_add (n : Int) : Int :=
  n + 10

```

**【表示されるフィードバック】**

> ✅ **Logic Verified:** このプログラムは数学的に整合しています。

---

## 6. 将来の拡張性

* **AI Integration:** Pythonの曖昧な記述を、AIがASTの「正しい型」へ推論・補完する機能。
* **Proof Visualization:** Leanが行っている証明プロセスを、人間が理解しやすいグラフとして可視化する機能。

---
