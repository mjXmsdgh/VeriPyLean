# VeriPyLean (Prototyping v0.1)

**"Human-readable Python, Machine-verifiable Lean 4."**

VeriPyLeanは、Pythonの「直感的な書きやすさ」と、Lean 4の「数学的な厳密性」を、共通のAST（抽象構文木）を介して結びつける実験的なプロジェクトです。

## 🌟 Concept: 「AIが書き、数学が査読する」

現代のAIコード生成は強力ですが、ハルシネーション（もっともらしい嘘）のリスクが常にあります。VeriPyLeanは、AIや人間が書いたPythonコードを背後でLean 4へと「直訳」し、定理証明の仕組みを使ってその正しさを数学的に検証します。

* **Python View**: 人間（およびAI）がロジックを読み書きするフロントエンド。
* **Lean 4 View**: 実行前に論理的矛盾（0除算、型不一致、停止性など）を検証するバックエンド。
* **AST-First**: ソースコードをテキストではなく「構造」として管理し、双方向の変換を1対1で実現します。

## 🎯 プロジェクトの対象範囲 (Scope)

すべてを網羅しようとせず、数学的検証が最も価値を発揮する「純粋なロジック」に集中します。

* **優先サポート対象（検証のコア）**:
* **数値計算・アルゴリズム**: 物理シミュレーション、統計処理、暗号化ロジックなどの純粋な数学的処理。
* **データ構造の操作**: リストの変換、ソート、フィルタリングなどの再帰を伴うロジック。
* **ガード条件の妥当性**: 0除算や配列の境界外参照を未然に防ぐための条件分岐。


* **対象外（Unverified Zone）**:
* **I/O・外部接続**: ファイル操作、ネットワーク通信、データベース接続。
* **UI/UX**: GUI、Webフレームワーク（Streamlit等）の表示ロジック自体。
* **動的なメタプログラミング**: 実行時の属性追加や複雑なクラス継承など、Lean 4への静的マッピングが困難な機能。

## ⚖️ 精度に対する妥協点と「ゆるやかな検証」

「完璧な数学的証明」を最終目標としつつ、実用上のステップとして「精度劣化の可視化」に重きを置きます。

### 1. 「完全な証明」から「警告（Warning）」へ

* あらゆるケースを100%証明できなくても、「この計算ステップで有効桁数が大幅に失われる可能性がある」という警告をLean 4からフィードバックするだけで十分な価値となります。

### 2. 数値誤差へのアプローチ

* **区間演算（Interval Arithmetic）の導入**: 単一の数値ではなく「真の値が含まれる範囲」をLean 4側に追跡させ、誤差の爆発を検知します。
* **打ち切り誤差のモデル化**: テイラー展開などの近似計算において、誤差のオーダーが設計上の許容範囲を超えていないかを「査読（数学的チェック）」します。

### 3. Lean 4 への「丸投げ」の活用

* 複雑な実解析（Real Analysis）の計算は自前で作らず、Lean 4の強力なライブラリ（mathlib）に計算の正当性を委ねます。
* Python側は「計算式」を正しくASTとして伝え、Lean 4側で「この式は理論上、精度が破綻する」と判定されれば、それをユーザーに伝えます。



## 🚀 現時点でできたこと

プロトタイプ v0.1 では、以下の変換と検証のフローが既に動作しています。

* [x] **四則演算の直訳**: Pythonの `+`, `-`, `*`, `//` を Lean 4 の演算子へ変換。
* [x] **条件分岐の対応**: `if-else` 構文の再帰的な変換。
* [x] **安全性チェック（プロトタイプ）**: 割り算が含まれる際に `if` 文によるガードがあるかを検知。

### デモコードの例

**Input (Python):**

```python
if b != 0:
    return 10 // b
else:
    return 0

```

**Output (Lean 4):**

```lean
def example (b : Int) : Int :=
  if b ≠ 0 then (10 / b) else 0

```

## 🛠 技術スタック

* **Language**: Python 3.10+
* **Parsing**: Standard `ast` module (Python純正の解析器)
* **UI**: Streamlit (爆速プロトタイピング)
* **Verification (Target)**: Lean 4

## 🗺 ロードマップ（手伝ってほしいこと）

私はこのプロジェクトのコンセプトを作り、最小限のプロトタイプを「ちまちま」作っています。このビジョンを完成させるためには、あなたの力が必要です。

1. **ASTマッピングの拡充**: リスト操作、再帰関数、ユーザー定義型への対応。
2. **Lean 4 Kernelとの統合**: 生成されたコードを実際にLean 4へ投げ、エラーフィードバックをPython側に反映する。
3. **AI Assist**: Pythonの曖昧な型指定を、AIを使ってLeanの厳密な型へ推論する機能。






## 🏗 このプロジェクトの最終目標：バトンを渡すこと

私はこの「PythonとLean 4を繋ぐ」という構想が、AI時代のソフトウェア開発において候補の一つとして考えています。しかし、私一人の実装能力では、このビジョンを完全に形にすることは不可能です。

### 🕊️ 開発者からのお願い

* **独立した実装は大歓迎です:** このプロジェクトのアイディアをベースに、全く別のリポジトリとして「ちゃんとした人」が「ちゃんとした実装」を始めることを、私は心から望んでいます。
* **アイディアの盗用・流用、大いに結構:** 「VeriPyLean」という名前を使っても、別の名前にしても構いません。この「数学によるAIコードの査読」という仕組みが世の中に普及することこそが、私の本望です。
* **私は「言い出しっぺ」で構いません:** 私はビジョンと最小限のプロトタイプを提示します。もしあなたが「これなら自分の方がうまく作れる」と思ったら、ぜひその直感に従ってください。
